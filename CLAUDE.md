## 0. このファイルの目的
本リポジトリにおいて、AI（Claude / Claude Code）が作業する際の
**思考様式・進め方・禁止事項・成果物のルール** を定義する。

本ファイルは「補助的ガイド」ではなく、
**AIが守るべき作業規約（運用ルール）** として扱う。

---

## 1. 最優先ルール（絶対遵守）
以下は例外なく守ること。

- 仕様が不明確なまま実装に着手しない
- 不明点は必ず AskUserQuestion で確認する（1回で終わらせない）
- TODO のフェーズ区切りを越えて **勝手に次へ進まない**
- 各フェーズ完了ごとにユーザーの承認を得る
- 実装は原則 TDD で行う
- 実装とレビューは sub-agent を分離する
- 機密情報は **いかなるファイルにも記載しない**
- Dev Log を作成せずに次フェーズへ進まない

---

## 2. 仕様固め（ヒアリング）プロセス

### 2.1 基本方針
- 実装より先に「何を作るか」を確定させる
- 曖昧さを残したまま進めない
- AIが勝手に仕様を補完しない

### 2.2 AskUserQuestion ルール
- 不明点・判断が分かれる点は AskUserQuestion を使用する
- AskUserQuestion は **複数回・段階的に行う**
- 質問は以下を意識する
  - YES / NO
  - 選択式
  - 具体例提示
- 仮定を置く場合は「仮定」と明示し、必ず確認する

---

## 3. 設計ファースト（SPECIFICATION）

### 3.1 成果物
仕様が十分に固まったら、最初に以下を作成する。

```
documents/SPECIFICATION.md
```

### 3.2 SPECIFICATION に含める内容
最低限、以下を含めること。

- 目的 / ゴール
- スコープ（やること / やらないこと）
- ユースケース・入出力
- データモデル（必要な場合）
- 非機能要件（性能・セキュリティ・制約）
- エラーハンドリング方針
- 受け入れ条件（Acceptance Criteria）

### 3.3 ルール
- SPECIFICATION を提示したらユーザーにレビューを依頼する
- 明示的な承認を得るまで TODO 作成に進まない

---

## 4. TODO 定義（フェーズ分割）

### 4.1 成果物
設計確定後、以下を作成する。

```
documents/TODO.md
```

### 4.2 TODO の考え方
- 「次に何をやればいいか」が一目で分かる粒度
- フェーズを細かく区切る（Phase 0, 1, 2...）
- 各フェーズは単独で確認・承認可能であること

### 4.3 各フェーズに必ず含める項目
- フェーズの目的
- 作業内容（チェックリスト）
- 変更対象
- 完了条件
- ユーザー確認項目

---

## 5. 実行ルール（フェーズゲート）

- TODO の順序を厳守する
- 1フェーズ完了ごとにユーザーへ動作確認を依頼する
- 承認が得られるまで次フェーズに進まない
- 仕様変更が入った場合は
  - SPECIFICATION
  - TODO
  を必ず更新して整合性を保つ

---

## 6. TDD（テスト駆動開発）

### 6.1 原則
- 実装は原則 TDD で行う

### 6.2 基本サイクル
1. 失敗するテストを書く
2. テストを通す最小実装
3. リファクタリング

### 6.3 例外対応
- UI / I/O 等でテスト困難な箇所は
  - コアロジックを分離してテストする
  - 代替の動作確認手順を明記する

---

## 7. sub-agent 分業ルール

### 7.1 役割
- **実装サブエージェント**
  - TODO に基づき TDD で実装
  - 実装内容・テスト・実行手順を整理して提出
- **レビューサブエージェント**
  - 設計・品質・テスト妥当性をレビュー
  - 指摘は「必須 / 推奨 / 任意」に分類

### 7.2 運用
- 各フェーズで必ず Reviewer を通す
- 指摘対応後にユーザー確認を行う

---

## 8. Dev Log（フェーズごとの開発ログ）

### 8.1 目的
- 作業の履歴・判断理由・失敗を記録し、再利用可能な知識にする

### 8.2 成果物
各フェーズ完了時に必ず以下を作成する。

```
documents/devlog/logXXXXXX.md
```

（6桁ゼロ埋め連番）

### 8.3 記載内容
- 対象フェーズ
- 実施内容の要約
- 技術的判断・理由
- レビュー内容と対応
- 問題点・反省
- 次フェーズへの申し送り

### 8.4 ルール
- Dev Log 作成後、ユーザーに内容を提示する
- 重要事項は SPECIFICATION / TODO に反映する

---

## 9. 機密情報・セキュリティ

### 9.1 絶対禁止
- APIキー、ID / パスワード、トークン、個人情報の記載
- ソースコード、設定ファイル、ドキュメントすべて対象

### 9.2 許可される方法
- プレースホルダの使用
- 環境変数名のみの記載
- 「別途安全な手段で設定する」と明記

### 9.3 レビュー観点
- Reviewer は機密情報混入を重点的に確認する
- その分野のエキスパートとして、最適な設計になっているか、可読性がよく可搬性のあるコードになっているかを確認する

---

## 10. コミュニケーション・出力規約
- 事実と推測を分ける
- 変更点は差分で示す
- 手順はコピペ可能にする
- 不明点が出たら即 AskUserQuestion に戻る