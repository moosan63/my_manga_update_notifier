# è¨­è¨ˆæ›¸

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
my_manga_update_notifier/
â”œâ”€â”€ CLAUDE.md
â”œâ”€â”€ documents/
â”‚   â”œâ”€â”€ TODO.md
â”‚   â”œâ”€â”€ specification.md
â”‚   â””â”€â”€ design.md
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ index.tsx          # ãƒˆãƒƒãƒ—ï¼ˆæ¼«ç”»ä¸€è¦§ï¼‰
â”‚   â”‚   â”œâ”€â”€ mangas/
â”‚   â”‚   â”‚   â”œâ”€â”€ new.tsx        # æ¼«ç”»è¿½åŠ 
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ edit.tsx   # æ¼«ç”»ç·¨é›†
â”‚   â”‚   â”œâ”€â”€ settings.tsx       # Slackè¨­å®š
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ mangas.ts      # æ¼«ç”»APIï¼ˆGET/POSTï¼‰
â”‚   â”‚       â”œâ”€â”€ mangas/
â”‚   â”‚       â”‚   â””â”€â”€ [id].ts    # æ¼«ç”»APIï¼ˆPUT/DELETEï¼‰
â”‚   â”‚       â””â”€â”€ settings.ts    # è¨­å®šAPI
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Layout.tsx         # å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ MangaForm.tsx      # æ¼«ç”»å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â”‚   â””â”€â”€ MangaList.tsx      # æ¼«ç”»ä¸€è¦§
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ db.ts              # D1ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚       â””â”€â”€ slack.ts           # Slacké€šçŸ¥
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 0001_init.sql          # åˆæœŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ mangas.test.ts
â”‚   â”‚   â””â”€â”€ settings.test.ts
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ slack.test.ts
â”œâ”€â”€ wrangler.toml
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

## APIè¨­è¨ˆ

### æ¼«ç”»API

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
|----------|------|------|------------|------------|
| GET | /api/mangas | ä¸€è¦§å–å¾— | - | `{ mangas: Manga[] }` |
| POST | /api/mangas | è¿½åŠ  | `{ title, url, dayOfWeek }` | `{ manga: Manga }` |
| PUT | /api/mangas/:id | æ›´æ–° | `{ title, url, dayOfWeek }` | `{ manga: Manga }` |
| DELETE | /api/mangas/:id | å‰Šé™¤ | - | `{ success: true }` |

### è¨­å®šAPI

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
|----------|------|------|------------|------------|
| GET | /api/settings | è¨­å®šå–å¾— | - | `{ slackWebhookUrl: string }` |
| POST | /api/settings | è¨­å®šä¿å­˜ | `{ slackWebhookUrl }` | `{ success: true }` |

### å‹å®šç¾©

```typescript
interface Manga {
  id: number;
  title: string;
  url: string;
  dayOfWeek: number;  // 0=æ—¥, 1=æœˆ, 2=ç«, 3=æ°´, 4=æœ¨, 5=é‡‘, 6=åœŸ
  createdAt: string;
  updatedAt: string;
}
```

## ç”»é¢è¨­è¨ˆ

### ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆæ¼«ç”»ä¸€è¦§ï¼‰: `/`

```
+------------------------------------------+
|  æ¼«ç”»æ›´æ–°é€šçŸ¥                    [è¨­å®š]   |
+------------------------------------------+
|  [+ æ–°è¦è¿½åŠ ]                            |
|                                          |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚ ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹          æ¯é€±æœˆæ›œæ—¥      â”‚  |
|  â”‚ https://...         [ç·¨é›†] [å‰Šé™¤]  â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚ å‘ªè¡“å»»æˆ¦            æ¯é€±æ—¥æ›œæ—¥      â”‚  |
|  â”‚ https://...         [ç·¨é›†] [å‰Šé™¤]  â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
+------------------------------------------+
```

### æ¼«ç”»è¿½åŠ /ç·¨é›†ãƒšãƒ¼ã‚¸: `/mangas/new`, `/mangas/:id/edit`

```
+------------------------------------------+
|  â† æˆ»ã‚‹    æ¼«ç”»ã‚’è¿½åŠ                     |
+------------------------------------------+
|                                          |
|  ã‚¿ã‚¤ãƒˆãƒ«                                |
|  [________________________]              |
|                                          |
|  URL                                     |
|  [________________________]              |
|                                          |
|  æ›´æ–°æ›œæ—¥                                |
|  [æ—¥|æœˆ|ç«|æ°´|æœ¨|é‡‘|åœŸ]                  |
|                                          |
|  [ä¿å­˜ã™ã‚‹]                              |
|                                          |
+------------------------------------------+
```

### è¨­å®šãƒšãƒ¼ã‚¸: `/settings`

```
+------------------------------------------+
|  â† æˆ»ã‚‹    è¨­å®š                          |
+------------------------------------------+
|                                          |
|  Slack Webhook URL                       |
|  [________________________]              |
|                                          |
|  [ä¿å­˜ã™ã‚‹]                              |
|                                          |
+------------------------------------------+
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### æ¼«ç”»ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  â†’ POST /api/mangas â†’ D1ã«ä¿å­˜ â†’ ä¸€è¦§ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

### Slacké€šçŸ¥ãƒ•ãƒ­ãƒ¼ï¼ˆCronï¼‰

```
Cron Triggerï¼ˆæ¯æ—¥0æ™‚JSTï¼‰
    â†“
scheduledã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    â†“
ç¾åœ¨ã®æ›œæ—¥ã‚’å–å¾—ï¼ˆJSTï¼‰
    â†“
D1ã‹ã‚‰è©²å½“æ›œæ—¥ã®æ¼«ç”»ã‚’å–å¾—
    â†“
å„æ¼«ç”»ã«ã¤ã„ã¦Slack Webhookã«æŠ•ç¨¿
```

### Slacké€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼

```json
{
  "text": "ğŸ“š æ¼«ç”»æ›´æ–°ã®ãŠçŸ¥ã‚‰ã›",
  "attachments": [
    {
      "title": "ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹",
      "title_link": "https://...",
      "color": "#36a64f"
    }
  ]
}
```

## Cronè¨­å®š

```toml
# wrangler.toml
[triggers]
crons = ["0 15 * * *"]  # UTC 15:00 = JST 0:00
```

## ãƒ†ã‚¹ãƒˆæ–¹é‡

### å˜ä½“ãƒ†ã‚¹ãƒˆ

- `lib/slack.ts`: Slacké€šçŸ¥é€ä¿¡ã®ãƒ¢ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- `lib/db.ts`: D1ã‚¯ã‚¨ãƒªã®ãƒ†ã‚¹ãƒˆ

### APIãƒ†ã‚¹ãƒˆ

- å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

### Cronãƒ†ã‚¹ãƒˆ

- `wrangler dev --test-scheduled`ã§ãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèª
